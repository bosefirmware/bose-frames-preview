var Bose=Bose||{},alreadyRegisteredEmailId="";Bose.GigyaService=function(){function a(){var a=$jq(".gigya-api-key").val();a&&Bose.CookieStore.get("glt_"+a)&&b(function(){m(function(a){Bose.AccountWidget.onGigyaLogin(a)})})}function b(a){var b=document.body,c=$jq(".js-accountWidget").attr("data-gigyaurl"),d=document.createElement("script");d.type="text/javascript",d.src=c,d.onload=function(){window.__gigyaConf={enableSSOToken:!0},gigya.accounts.addEventHandlers({onLogin:function a(b){Bose.DataLayer.setMyAccountVariable("name","my_account"),$jq(document).trigger("trackSignInSuccess");var c=$jq(".bose-accountWidget__text.js-accountWidget-options");if(c.length){var d=window.location.origin+c.attr("href");window.location.href!==d&&window.location.replace(d)}Bose.AccountWidget.onGigyaLogin(b)}}),"function"==typeof a&&a()},b.appendChild(d)}function c(){var a=function a(){var b={account_temporarily_locked_out:$jq(".gigya-account-lock-message").attr("data-value")};gigya.accounts.showScreenSet({screenSet:"MyAccount-RegistrationLogin",startScreen:"gigya-login-screen",onAfterScreenLoad:j,customLang:b}),Bose.DataLayer.setMyAccountVariable("name","my_account"),$jq(document).trigger("trackSignInView")};"undefined"==typeof gigya?b(a):a()}function d(){"undefined"!=typeof gigya&&gigya.accounts.showScreenSet({screenSet:"MyAccount-RegistrationLogin",startScreen:"gigya-register-screen"})}function e(){"undefined"!=typeof gigya&&gigya.accounts.showScreenSet({screenSet:"MyAccount-ProfileUpdate",startScreen:"gigya-update-profile-screen",onAfterScreenLoad:j,onSubmit:l})}function f(){"undefined"!=typeof gigya&&gigya.accounts.showScreenSet({screenSet:"MyAccount-ProfileUpdate",startScreen:"gigya-change-password-screen",onAfterScreenLoad:j,onAfterSubmit:i})}function g(){j({currentScreen:"gigya-forgot-password-screen"})}function h(){j({currentScreen:"gigya-verification-pending-screen"})}function i(a){"gigya-change-password-screen"===a.screen&&Bose.UserData.populateNebualDataInGlobalObject(Bose.UserData.gigyaUID)}function j(a){switch($jq("#"+a.currentScreen+" > form").prop("action",window.location.protocol+"//"+window.location.hostname),Bose.DataLayer.setMyAccountVariable("screenSet",a.currentScreen),a.currentScreen){case"gigya-forgot-password-success-screen":var b=$jq("#reset-email-for-account");b.length&&b.html(a.response.requestParams.loginID);break;case"gigya-register-screen":$jq("form.gigya-register-form input[type='email']").on("invalid",function(a){a.preventDefault()});var c=$jq(".email-validation");Bose.DataLayer.setMyAccountVariable("name","my_account"),$jq(document).trigger("trackRegistrationEntry"),c.length&&c.on("click",k);break;case"gigya-login-screen":null!==alreadyRegisteredEmailId&&($jq("#gigya-textbox-loginID").val(alreadyRegisteredEmailId.trim()),alreadyRegisteredEmailId="");break;case"gigya-forgot-password-screen":Bose.DataLayer.setMyAccountVariable("name","my_account"),$jq(document).trigger("trackPasswordEntry");break;case"gigya-verification-pending-screen":Bose.DataLayer.setMyAccountVariable("name","my_account"),$jq(document).trigger("trackSuccessfulAccountCreation")}}function k(){alreadyRegisteredEmailId=$jq('.register-email .gigya-input-text[data-gigya-type="email"]').val(),c()}function l(){Bose.Utils.reloadPage()}function m(a,b){"undefined"!=typeof gigya&&gigya.accounts.getAccountInfo({callback:function c(d){d&&(0===d.errorCode?a&&"function"==typeof a&&a(d):b&&"function"==typeof b&&b(d))}})}function n(){"undefined"!=typeof gigya&&gigya.accounts.logout({callback:function a(){Bose.Utils.reloadPage()}})}return{init:a,login:c,register:d,userProfile:e,userPwd:f,forgotPwd:g,verificationPending:h,logout:n,getAccountInfo:m}}();
$jq(document).ready(function(){Bose.GigyaService.init()});
