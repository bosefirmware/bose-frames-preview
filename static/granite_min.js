!function(e,t){var n;t.Granite=t.Granite||{},t.Granite.$=t.Granite.$||e,t._g=t._g||{},t._g.$=t._g.$||e,n=Granite.HTTP,e.ajaxSetup({externalize:!0,encodePath:!0,hook:!0,beforeSend:function(t,r){if("undefined"!=typeof G_IS_HOOKED&&G_IS_HOOKED(r.url)||(r.externalize&&(r.url=n.externalize(r.url)),r.encodePath&&(r.url=n.encodePathOfURI(r.url))),r.hook){var i=n.getXhrHook(r.url,r.type,r.data);i&&(r.url=i.url,i.params&&("GET"==r.type.toUpperCase()?r.url+="?"+e.param(i.params):r.data=e.param(i.params)))}},statusCode:{403:function(e){"Authentication Failed"===e.getResponseHeader("X-Reason")&&n.handleLoginRedirect()}}}),e.ajaxSettings.traditional=!0}(jQuery,this);
!function(e,t){function r(){this._handler=[]}function n(e){var t=document.location.host,r=document.location.protocol,n="//"+t,o=r+n;return e==o||e.slice(0,o.length+1)==o+"/"||e==n||e.slice(0,n.length+1)==n+"/"||!/^(\/\/|http:|https:).*/.test(e)}function o(){var e=document.location.protocol;if("http:"===e){i=new r;var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState)try{var e=JSON.parse(t.responseText);c=e.token,i.resolve(c)}catch(r){i.reject(t.responseText)}},t.open("GET",Granite.HTTP.externalize(l),!0),t.send()}else i=new r,c=null,i.resolve(c)}function s(e){if(!e.action||n(e.getAttribute("action"))){var t=e.querySelector('input[name="'+u+'"]');t||(t=document.createElement("input"),t.setAttribute("type","hidden"),t.setAttribute("name",u),e.appendChild(t)),t.setAttribute("value",c)}}function a(e){var t=function(e){var t=e.target;"form"===t.nodeName.toLowerCase()&&c&&s(t)};e.addEventListener?e.addEventListener("submit",t,!0):e.attachEvent&&e.attachEvent("submit",t)}if(e.Granite=e.Granite||{},!e.Granite.csrf){e.Granite.csrf={initialised:!1},r.prototype={then:function(e,t){this._handler.push({resolve:e,reject:t})},resolve:function(){this._execute("resolve",arguments)},reject:function(){this._execute("reject",arguments)},_execute:function(t,r){if(null===this._handler)throw Error("Promise already completed.");for(var n=0,o=this._handler.length;o>n;n++)this._handler[n][t].apply(e,r);this.then=function(n,o){("resolve"===t?n:o).apply(e,r)},this._handler=null}};var i,c,u=":cq_csrf_token",p="CSRF-Token",l="/libs/granite/csrf/token.json";o(),a(document);var h=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,t){return n(t)&&"get"!==e.toLowerCase()&&(this._csrf=!0),h.apply(this,arguments)};var d=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){if(!this._csrf)return d.apply(this,arguments),t;if(c)return this.setRequestHeader(p,c),d.apply(this,arguments),t;var r=this,n=Array.prototype.slice.call(arguments);i.then(function(e){r.setRequestHeader(p,e),d.apply(r,n)},function(){e.console&&console.error("Unable to read CSRF meta information"),d.apply(r,n)})};var f=HTMLFormElement.prototype.submit;if(HTMLFormElement.prototype.submit=function(){return s(this),f.apply(this,arguments)},e.Node){var m=Node.prototype.appendChild;Node.prototype.appendChild=function(){var e=m.apply(this,arguments);return"IFRAME"===e.nodeName&&e.contentWindow&&!e._csrf&&(e._csrf=!0,a(e.contentWindow.document)),e}}setInterval(function(){o()},3e5)}}(this);
